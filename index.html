<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Welcoming + CRISP LGA Map</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    html, body { margin:0; height:100%; }
    #map { width:100%; height:100%; }
  </style>
</head>
<body>

<!-- ⭐ SVG PATTERN FOR BOTH (blue + orange stripes) -->
<svg width="0" height="0">
  <defs>
    <pattern id="blueOrangePattern" patternUnits="userSpaceOnUse" width="12" height="12" patternTransform="rotate(45)">
      <rect width="6" height="12" fill="#4f83cc" />
      <rect x="6" width="6" height="12" fill="#e8a04b" />
    </pattern>
  </defs>
</svg>

<div id="map"></div>

<script>
// ⭐⭐ RAW GITHUB URLs ⭐⭐
const GEOJSON_URL =
  "https://raw.githubusercontent.com/<YOUR-USER>/<YOUR-REPO>/main/LGA_2025_AUST_GDA2020.min.json";

const WELC_URL =
  "https://raw.githubusercontent.com/<YOUR-USER>/<YOUR-REPO>/main/welcoming_lgas.csv";

const CRISP_URL =
  "https://raw.githubusercontent.com/<YOUR-USER>/<YOUR-REPO>/main/crisp_lgas.csv";

// PapaParse loader
function loadCSV(url) {
  return fetch(url)
    .then(r => r.text())
    .then(t => Papa.parse(t, { header: true, skipEmptyLines: true }).data);
}

const LGA_FIELD = "LGA_NAME25";  // same as your working map
const welcomingColor = "#4f83cc";
const crispColor = "#e8a04b";

const map = L.map("map").setView([-25,134],4);
L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

Promise.all([
  loadCSV(WELC_URL),
  loadCSV(CRISP_URL),
  fetch(GEOJSON_URL).then(r => r.json())
])
.then(([welcRows, crispRows, geojson]) => {

  // Convert CSV lists → Sets
  const welcomingSet = new Set(
    welcRows.map(r => r.lga_name?.trim()).filter(Boolean)
  );

  const crispSet = new Set(
    crispRows.map(r => r.LGA?.trim()).filter(Boolean)
  );

  console.log("Welcoming:", welcomingSet);
  console.log("CRISP:", crispSet);

  // ⭐⭐ STYLE LOGIC ⭐⭐
  function style(feature) {
    const name = feature.properties[LGA_FIELD];
    const inW = welcomingSet.has(name);
    const inC = crispSet.has(name);

    // BOTH → striped pattern (blue + orange)
    if (inW && inC) {
      return {
        fillColor: "url(#blueOrangePattern)",
        color: "#222",
        weight: 1,
        fillOpacity: 1
      };
    }

    // Welcoming only → blue
    if (inW) {
      return {
        fillColor: welcomingColor,
        color: "#1e3d66",
        weight: 1,
        fillOpacity: 0.75
      };
    }

    // CRISP only → orange
    if (inC) {
      return {
        fillColor: crispColor,
        color: "#8a5a1f",
        weight: 1,
        fillOpacity: 0.75
      };
    }

    // All others → transparent outline
    return {
      fillColor: "transparent",
      color: "#ccc",
      weight: 0.4,
      fillOpacity: 0
    };
  }

  // Draw LGAs
  L.geoJSON(geojson, {
    style,
    onEachFeature: (feature, layer) => {
      const name = feature.properties[LGA_FIELD];
      const labels = [];
      if (welcomingSet.has(name)) labels.push("Welcoming Cities");
      if (crispSet.has(name)) labels.push("CRISP");
      layer.bindTooltip(`<b>${name}</b><br>${labels.join(" & ") || ""}`);
    }
  }).addTo(map);

  // Fit to Australia
  map.fitBounds(L.geoJSON(geojson).getBounds());
});

</script>
</body>
</html>
