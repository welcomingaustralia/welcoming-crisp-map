<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Welcoming Cities + CRISP LGA Map</title>

  <!-- Leaflet core -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Leaflet Pattern plugin (for striped ‚Äúboth‚Äù areas) -->
  <script src="https://unpkg.com/leaflet.pattern/dist/leaflet.pattern.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    .legend {
      background: white;
      padding: 8px 12px;
      line-height: 1.4;
      font-size: 13px;
      border-radius: 4px;
      box-shadow: 0 0 4px rgba(0,0,0,0.3);
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }
    .legend-color {
      width: 18px;
      height: 18px;
      border: 1px solid #555;
      margin-right: 6px;
    }

    /* Dropdown styling */
    #stateSelector {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 9999;
      padding: 6px;
      background: white;
      border-radius: 4px;
      border: 1px solid #777;
    }
  </style>
</head>

<body>

<!-- State dropdown -->
<select id="stateSelector">
  <option value="">Select a state/territory</option>
  <option value="NSW">New South Wales</option>
  <option value="VIC">Victoria</option>
  <option value="QLD">Queensland</option>
  <option value="SA">South Australia</option>
  <option value="WA">Western Australia</option>
  <option value="TAS">Tasmania</option>
  <option value="NT">Northern Territory</option>
  <option value="ACT">Australian Capital Territory</option>
</select>

<div id="map"></div>

<script>
// --------------------------------------------------
// TEST: Print when files load or fail
// --------------------------------------------------
console.log("Starting map...");

// 1. CSV loader
function loadCSVAsSet(url) {
  console.log("Loading CSV:", url);
  return fetch(url)
    .then(res => {
      if (!res.ok) {
        console.error("CSV FAILED to load:", url, res.status);
      }
      return res.text();
    })
    .then(text => {
      console.log("CSV loaded OK:", url);
      return new Set(
        text
          .split(/\r?\n/)
          .map(l => l.trim())
          .filter(Boolean)
      );
    });
}

const LGA_NAME_FIELD = "LGA_NAME21"; // our best guess

// 2. Setup map
const map = L.map("map").setView([-25.5, 134.5], 4);

L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 18
}).addTo(map);

console.log("Map created");

// --------------------------------------------------
// 3. Load EVERYTHING with diagnostics
// --------------------------------------------------
Promise.all([
  loadCSVAsSet("data/welcoming_lgas.csv"),
  loadCSVAsSet("data/crisp_lgas.csv"),
  fetch("data/LGA_2025_AUST_GDA2020.min.json")
    .then(res => {
      if (!res.ok) {
        console.error("GEOJSON FAILED to load:", res.status);
      } else {
        console.log("GeoJSON loaded OK");
      }
      return res.json();
    })
]).then(([welcomingSet, crispSet, geojsonData]) => {

  console.log("DATASETS loaded. Now checking GeoJSON structure...");

  if (!geojsonData || !geojsonData.features) {
    console.error("GeoJSON is empty or malformed.");
    return;
  }

  console.log("Number of features:", geojsonData.features.length);

  // Print first feature
  console.log("First feature properties:", geojsonData.features[0].properties);

  // Check if LGA_NAME_FIELD exists
  if (!(LGA_NAME_FIELD in geojsonData.features[0].properties)) {
    console.error("‚ùå LGA name field NOT FOUND:", LGA_NAME_FIELD);
    console.log("Available keys:", Object.keys(geojsonData.features[0].properties));
    return;
  } else {
    console.log("‚úî LGA name field FOUND:", LGA_NAME_FIELD);
  }

  // If code reaches here, we know the data is correct ‚Üí polygons will load once styling is added
  console.log("üéâ All data is valid. We can safely rebuild the full map now.");

});
</script>


</body>
</html>
