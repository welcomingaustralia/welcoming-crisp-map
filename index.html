<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Welcoming LGA Test</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- PapaParse â€” REQUIRED (same as working map) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    html, body { margin:0; height:100%; }
    #map { width:100%; height:100%; }
  </style>
</head>

<body>

<div id="map"></div>

<script>

// Load CSV with header (same method as your working map)
function loadCSV(url) {
  return fetch(url)
    .then(r => r.text())
    .then(t => Papa.parse(t, { header: true, skipEmptyLines: true }).data);
}

const LGA_FIELD = "LGA_NAME25";  // EXACTLY like your working map

const map = L.map("map").setView([-25, 134], 4);
L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

Promise.all([
  loadCSV("welcoming_lgas.csv"),
  fetch("LGA_2025_AUST_GDA2020.min.json").then(r => r.json())
])
.then(([welcRows, geojson]) => {

  // Turn CSV into a Set
  // EXACT logic from your old map.
  const welcomingSet = new Set(
    welcRows.map(r => r.lga_name?.trim()).filter(Boolean)
  );

  console.log("Welcoming LGAs loaded:", welcomingSet);

  // Style ONLY welcoming LGAs
  function style(feature) {
    const name = feature.properties[LGA_FIELD];

    if (welcomingSet.has(name)) {
      return {
        fillColor: "#4f83cc",
        color: "#1e3d66",
        weight: 1,
        fillOpacity: 0.7
      };
    }

    // All others: transparent fill + simple border
    return {
      fillColor: "transparent",
      color: "#ccc",
      weight: 0.4,
      fillOpacity: 0
    };
  }

  // Draw polygons
  L.geoJSON(geojson, {
    style,
    onEachFeature: (f, layer) => {
      layer.bindTooltip(f.properties[LGA_FIELD]);
    }
  }).addTo(map);

  map.fitBounds(L.geoJSON(geojson).getBounds());
});

</script>

</body>
</html>
